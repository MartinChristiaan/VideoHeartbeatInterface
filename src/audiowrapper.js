module.exports = {
    start_audio_player:function(onset_times,onset_frequencies)
    {
        var sound = new Howl({
            src: ['Darkside.mp3']
          });
          sound.play();
          canvas = document.querySelector('canvas')
          canvas.width = innerWidth
          canvas.height = innerHeight

          onset_times = [  1.27695747,   1.99669714,   2.71643681,   4.13269873,
            4.82922099,   5.17748212,   5.52574325,   6.59374404,
            6.77948331,   6.94200517,   7.5456578 ,   7.66174484,
            8.3582671 ,  10.47105128,  10.81931241,  11.19079095,
           11.8873132 ,  12.58383546,  13.30357513,  14.00009739,
           14.41801074,  14.71983705,  15.41635931,  16.11288157,
           16.48436011,  16.83262124,  17.06479532,  17.25053459,
           17.36662163,  17.57557831,  17.90062203,  18.06314389,
           18.22566575,  18.94540542,  19.52584063,  19.64192768,
           19.9669714 ,  20.12949326,  20.36166734,  20.73314588,
           21.0581896 ,  21.75471186,  22.1261904 ,  22.47445153,
           23.89071345,  24.58723571,  25.28375797,  25.6320191 ,
           26.00349763,  26.37497617,  26.7232373 ,  27.41975956,
           27.7912381 ,  28.11628182,  28.48776035,  28.6270648 ,
           28.83602148,  29.18428261,  29.37002188,  29.53254374,
           29.88080487,  30.229066  ,  30.60054454,  30.94880566,
           31.3202842 ,  31.52924088,  31.64532792,  32.04002387,
           32.36506759,  33.06158985,  33.36341616,  33.75811211,
           35.17437403,  35.8941137 ,  36.59063595,  36.96211449,
           37.28715821,  37.89081084,  38.03011529,  38.35515901,
           38.70342014,  39.05168127,  39.46959462,  39.77142093,
           40.11968206,  40.4911606 ,  40.67689987,  40.83942173,
           41.18768286,  41.37342213,  41.53594399,  41.90742252,
           42.23246624,  42.60394478,  42.9289885 ,  43.18438   ,
           43.32368445,  43.48620631,  43.67194558,  43.85768485,
           43.9969893 ,  44.34525043,  44.69351156,  45.06499009,
           45.41325122,  45.73829494,  46.29551275,  46.50446943,
           46.80629574,  47.01525242,  47.17777428,  47.54925281,
           47.87429653,  48.24577507,  48.5940362 ,  48.8494277 ,
           49.19768883,  49.29055846,  49.63881959,  50.01029813,
           50.35855926,  50.70682038,  51.07829892,  51.40334264,
           51.65873414,  51.77482118,  52.00699527,  52.12308231,
           52.49456085,  52.81960457,  53.1910831 ,  53.51612682,
           53.88760536,  54.09656204,  54.23586649,  54.46804058,
           54.81630171,  54.93238875,  55.16456284,  55.30386729,
           55.51282396,  55.65212842,  55.86108509,  56.00038955,
           56.23256363,  56.34865067,  56.48795513,  56.6969118 ,
           56.83621625,  57.04517293,  57.20769479,  57.30056443,
           57.41665147,  57.55595592,  57.7649126 ,  58.34534781,
           58.48465227,  59.18117452,  59.76160974,  59.87769678,
           60.13308828,  60.24917532,  60.458132  ,  60.59743645,
           60.71352349,  60.82961053,  60.94569758,  61.29395871,
           61.64221984,  62.59413359,  62.71022063,  63.08169917,
           63.29065585,  63.77822143,  64.12648256,  64.47474368,
           65.40344003,  65.51952707,  65.77491857,  65.89100561,
           66.09996229,  66.23926674,  66.37857119,  66.47144082,
           66.58752787,  66.935789  ,  67.28405013,  68.23596388,
           68.35205092,  68.72352946,  68.93248614,  69.07179059,
           69.42005172,  69.76831285,  70.11657397,  70.4648351 ,
           70.83631364,  71.18457477,  71.5328359 ,  71.76500999,
           71.88109703,  72.22935816,  72.60083669,  72.83301078,
           72.94909782,  73.29735895,  73.413446  ,  73.64562008,
           73.99388121,  74.34214234,  74.71362088,  74.82970792,
           75.06188201,  75.41014314,  75.75840426,  76.1298828 ,
           76.68710061,  76.80318765,  77.40684028,  77.54614473,
           77.7551014 ,  77.89440586,  78.24266698,  78.59092811,
           79.51962446,  79.6357115 ,  80.00719004,  80.23936412,
           80.35545117,  80.7037123 ,  81.42345196,  82.11997422,
           82.46823535,  82.81649648,  83.00223575,  83.16475761,
           83.53623615,  83.86127987,  84.2327584 ,  84.55780212,
           84.92928066,  85.11501993,  85.27754179,  85.64902033,
           85.81154219,  85.99728146,  86.34554259,  86.69380372,
           87.04206484,  87.27423893,  87.41354338,  87.76180451,
           88.11006564,  88.45832677,  88.73693567,  88.8065879 ,
           89.17806644,  89.52632756,  89.80493647,  89.87458869,
           90.22284982,  90.45502391,  90.59432836,  90.94258949,
           91.29085062,  91.5230247 ,  91.63911175,  92.01059029,
           92.33563401,  92.70711254,  93.05537367,  93.38041739,
           93.75189593,  94.12337447,  94.40198337,  94.4716356 ,
           94.81989673,  95.16815785,  95.53963639,  95.86468011,
           96.18972383,  96.23615865,  96.51476755,  96.58441978,
           96.74694164,  96.93268091,  97.28094204,  97.62920317,
           97.9774643 ,  98.34894283,  98.51146469,  98.69720396,
           99.04546509,  99.23120436,  99.39372622,  99.62590031,
           99.76520476,  99.99737884, 100.11346589, 100.46172702,
          100.80998814, 101.15824927, 101.5065104 , 101.87798894,
          102.22625007, 102.5745112 , 102.82990269, 102.92277233,
          103.29425087, 103.64251199, 103.99077312, 104.33903425,
          105.05877392, 105.43025246, 105.77851359, 106.12677471,
          106.26607917, 106.47503584, 106.82329697, 106.98581883,
          107.1715581 , 107.51981923, 107.86808036, 108.2395589 ,
          108.91286375, 109.28434228, 110.00408195, 110.35234308,
          110.51486494, 110.70060421, 111.02564793, 111.39712647,
          111.79182241, 112.11686613, 112.46512726, 112.79017098,
          112.90625803, 113.06877989, 113.20808434, 113.3706062 ,
          113.50991065, 113.88138919, 113.99747623, 114.22965032,
          114.53147663, 114.87973776, 114.94938998, 115.2744337 ,
          115.64591224, 116.01739078, 116.3424345 , 116.59782599,
          116.94608712, 117.06217417, 117.29434825, 117.41043529,
          117.75869642, 118.10695755, 118.52487091, 118.82669722,
          119.08208871, 119.17495835, 119.40713243, 119.54643689,
          119.89469801, 120.24295914, 120.42869841, 120.59122027,
          120.9394814 , 121.28774253, 121.65922107, 121.98426479,
          122.23965628, 122.5414826 , 122.72722186, 122.91296113,
          123.05226558, 123.40052671, 123.74878784, 124.14348379,
          124.46852751, 124.79357123, 125.18826718, 125.35078904,
          125.5365283 , 125.83835462, 126.0705287 , 126.23305056,
          126.6045291 , 126.92957282, 127.30105136, 127.64931249,
          127.88148657, 128.02079103, 128.34583475, 128.69409587,
          129.042357  , 129.41383554, 129.76209667, 130.1103578 ,
          130.45861893, 130.71401042, 130.83009747, 131.17835859,
          131.52661972, 131.87488085, 132.24635939, 132.57140311,
          132.94288165, 133.15183833, 133.29114278, 133.87157799,
          133.98766504, 134.21983912, 134.35914357, 134.56810025,
          134.7074047 , 134.91636138, 135.05566583, 135.40392696,
          135.54323141, 135.75218809, 135.98436218, 136.10044922,
          136.35584071, 136.47192776, 136.68088443, 136.82018888,
          137.37740669, 137.58636337, 138.23645081, 138.93297307,
          139.16514715, 139.30445161, 139.51340828, 139.65271273,
          139.76879978, 139.88488682, 140.00097386, 140.34923499,
          140.69749612, 141.62619247, 141.74227951, 141.997671  ,
          142.11375805, 142.34593213, 142.46201917, 142.83349771,
          143.18175884, 143.53001997, 144.45871631, 144.57480336,
          144.83019485, 144.9462819 , 145.15523857, 145.29454302,
          145.41063007, 145.52671711, 145.64280415, 145.99106528,
          146.33932641, 147.29124016, 147.40732721, 147.77880574,
          147.98776242, 148.475328  , 148.82358913, 149.17185026,
          149.52011139, 149.89158993, 150.21663365, 150.58811219,
          150.82028627, 150.93637331, 151.14532999, 151.28463444,
          151.65611298, 151.88828707, 152.00437411, 152.35263524,
          152.46872228, 152.70089637, 153.0491575 , 153.39741863,
          153.76889716, 153.88498421, 154.11715829, 154.46541942,
          154.81368055, 155.37089836, 155.74237689, 155.85846394,
          156.46211656, 156.5782036 , 156.81037769, 156.92646473,
          157.29794327, 157.62298699, 158.57490074, 158.69098779,
          159.06246632, 159.271423  , 159.41072745, 159.75898858,
          160.10724971, 160.47872825, 162.22003389, 162.59151243,
          163.63629582, 164.72751402, 164.89003588, 165.05255774,
          166.46881967, 167.16534193, 167.88508159, 168.92986498,
          169.27812611, 169.99786578, 170.69438803, 171.39091029,
          172.01778032, 172.11064996, 172.83038962, 173.17865075,
          173.52691188, 173.87517301, 174.22343414, 174.80386936,
          174.94317381, 176.33621832, 177.03274058, 177.40421912,
          177.65961061, 177.75248025, 178.10074138, 178.47221991,
          179.05265513, 179.16874217, 180.21352556, 180.56178669,
          180.93326523, 181.88517898, 182.34952715, 182.69778828,
          183.04604941, 183.39431054, 184.1140502 , 184.81057246,
          185.06596396, 185.182051  , 185.87857326, 186.22683439,
          186.92335665, 187.29483518, 187.52700927, 187.64309631,
          187.99135744, 188.33961857, 188.6878797 , 189.63979345,
          189.73266309, 190.01127199, 190.12735903, 190.3130983 ,
          190.66135943, 190.82388129, 191.17214242, 191.52040355,
          192.44909989, 192.54196953, 192.93666547, 193.16883956,
          193.2849266 , 193.98144886, 194.3529274 , 195.04944966,
          195.39771078, 195.76918932, 196.00136341, 196.11745045,
          196.44249417, 196.81397271, 197.16223384, 197.88197351,
          198.23023463, 198.57849576, 198.92675689, 199.27501802,
          199.62327915, 199.99475769, 200.34301882, 200.92345403,
          201.03954107, 201.61997629, 201.75928074, 201.96823742,
          202.10754187, 202.455803  , 202.80406413, 203.73276047,
          203.87206492, 204.22032605, 204.45250014, 204.56858718,
          204.94006572, 205.28832685, 205.63658798]

          onset_frequencies = [ 7,  7,  4,  2,  2,  2,  4,  2,  2,  2,  2,  9,  2,  2,  2,  4,  0,
            7,  7,  4,  7,  9,  6,  2,  2,  0,  0,  4,  7,  6,  2,  2,  7,  9,
            2,  4,  4,  4,  4, 11,  6,  2,  2,  7,  2,  7,  4,  4,  4,  4,  2,
            2,  2,  0,  0,  0,  6,  7,  2,  7,  7,  9,  6,  4,  4,  4,  4,  4,
            6,  2,  2,  0,  2,  2,  4,  4, 11,  4,  7,  7,  7,  7,  7,  0,  0,
            0,  0,  0,  2,  2,  2,  2,  4,  4,  0,  4,  4,  4,  4,  7,  7,  7,
            7,  7,  0,  0,  0,  2,  2,  2,  2,  2,  4,  4,  4,  4,  4,  4,  7,
            7,  7,  7,  0,  0,  0,  0,  0, 11,  2,  2,  2,  2,  4,  4,  4,  4,
            4,  4,  7,  7,  7,  8,  7,  7,  7,  7,  4,  0,  0,  0,  0,  0,  0,
            0,  5,  5,  5,  6,  4,  4,  4,  4,  5,  5,  7,  7,  7,  7,  7,  4,
            0,  0,  0,  2,  5,  2,  4,  4,  4,  4,  4,  7,  7,  7,  7,  7,  7,
            4,  0,  0, 11,  2,  2,  2,  2,  4,  4,  4,  4,  7,  7,  7,  7,  7,
            7,  7,  7,  0,  4,  4,  2,  2,  2,  2,  2,  2,  7,  7,  7,  7,  7,
            7,  7,  7,  4,  4,  0,  0,  2,  2,  2,  4,  4,  4,  4,  4,  2,  2,
            2,  2,  0,  0,  0,  0,  0,  6,  7,  7,  6,  6,  6,  4,  4,  4,  4,
            4,  2,  2,  2,  2,  2,  7,  7, 11,  0,  0,  7,  7,  6,  6,  4,  4,
            4,  4,  4,  4,  2,  2,  2,  2,  0,  0,  0, 11,  0,  0,  0,  7,  7,
            6,  6,  6,  4,  4,  4,  4,  4,  4,  6,  2,  2,  2,  2,  0,  0,  0,
            7,  7,  7,  6,  6,  6,  4,  7,  2,  2,  2,  2, 11,  2,  7,  4,  7,
           11,  7,  7,  4,  4,  4,  4,  7,  2,  2,  2, 11,  2,  4,  2,  6,  7,
            7, 11,  4,  6,  6,  4,  4,  7,  4,  4, 11,  4,  4,  4,  7,  7,  7,
            7,  7,  0,  0,  0,  0,  0,  2,  2,  2,  2,  2,  4,  4,  0,  4,  4,
            4,  7,  7,  7,  7,  0,  0,  0,  0,  0,  1,  2,  2,  2,  2,  4,  4,
            4,  4,  4,  4,  7,  7,  7,  7,  4,  0,  0,  0,  0,  2,  2,  2,  2,
            4,  3,  7,  4,  4,  7,  7,  7,  8,  7,  7,  7,  4,  0,  0,  0,  0,
            0,  0,  5,  4,  4,  6,  4,  4,  4,  5,  5,  7,  7,  7,  7,  7,  4,
            4,  0,  0,  0,  2,  2,  5,  2,  4,  4,  4,  4,  4,  7,  7,  7,  7,
            7,  7,  4,  0,  0,  0,  2,  2,  2,  4,  4,  4,  4,  7,  7,  7,  7,
            7,  7,  7,  7,  7,  0,  4,  4,  2,  2,  2,  2,  2,  4,  7,  5,  7,
            7,  7,  7,  7,  7,  4,  0,  0,  0,  2,  2,  2,  2,  9,  7, 11, 10,
           10,  2,  0,  7,  2,  2,  4,  4,  2,  2,  4,  4,  4,  4,  4,  2,  2,
            2,  2,  2,  2,  2,  2,  2,  4,  4,  4,  7,  7,  7,  0,  0,  0,  0,
            0,  0,  7,  7,  9, 11,  2,  4,  4,  0,  0,  2,  2,  3,  2,  4,  4,
            7,  4,  4,  7,  7,  7,  7,  0,  4,  0,  0,  2,  2,  2,  4,  4,  4,
            7,  7,  7,  7,  7,  0,  7,  4,  2,  2,  2,  2,  2,  7,  5,  7,  7,
            7,  7,  7,  7,  4,  0,  0, 11,  2,  2,  3,  2]

          function draw()
          {
  
              t_cur = sound.seek()
              t_max = (t_cur + 2)
              t_min = (t_cur - 0.4)
              duration = sound.duration()
              var ctx = canvas.getContext('2d')
  
              ctx.clearRect(0, 0, innerWidth, innerHeight); // clear canvas


              for (let i = 0; i < onset_times.length; i++) {
                const time = onset_times[i];

                if (time>t_min && time<t_max) {
                  freq = onset_frequencies[i]
                  percent = 1 - (time - t_min)/(t_max - t_min);
                  ctx.beginPath();
                  ctx.arc(freq*innerWidth/11,percent*innerHeight,10,0,Math.PI*2,false)
                  ctx.fillStyle = "white"
                  ctx.fill()
                  ctx.restore();
                }
                
              }
              y_now = (1 - (t_cur - t_min)/(t_max - t_min)) * innerHeight;
              ctx.strokeStyle = "white"
              ctx.lineWidth = 10;
              ctx.beginPath();
              ctx.moveTo(0,y_now)
              ctx.lineTo(innerWidth, y_now);
              ctx.stroke();

              window.requestAnimationFrame(draw);
          }
          draw()
          
        

          return function(){
            percent = sound.seek()/sound.duration()
  //          console.log(percent)

            return percent}
    },
    
    
       
    
}